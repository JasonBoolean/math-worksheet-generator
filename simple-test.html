<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Test</title>
    <style>
        body { margin: 20px; font-family: Arial, sans-serif; }
        button { padding: 10px 15px; margin: 5px; background: #2196f3; color: white; border: none; border-radius: 4px; cursor: pointer; }
        canvas { border: 2px solid #333; margin: 10px 0; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>Simple Test - 检查基础功能</h1>
    
    <div>
        <button onclick="testBasic()">测试基础功能</button>
        <button onclick="testApp()">测试应用初始化</button>
        <button onclick="clearLog()">清空日志</button>
    </div>
    
    <canvas id="test-canvas" width="400" height="300"></canvas>
    
    <div class="log" id="log"></div>

    <script>
        function log(msg) {
            console.log(msg);
            const logEl = document.getElementById('log');
            if (logEl) {
                logEl.innerHTML += new Date().toLocaleTimeString() + ': ' + msg + '\n';
                logEl.scrollTop = logEl.scrollHeight;
            }
        }
        
        function clearLog() {
            const logEl = document.getElementById('log');
            if (logEl) {
                logEl.innerHTML = '';
            }
        }
        
        function testBasic() {
            clearLog();
            log('开始基础测试...');
            
            // 测试Canvas基础功能
            const canvas = document.getElementById('test-canvas');
            if (!canvas) {
                log('错误: 找不到canvas元素');
                return;
            }
            
            const ctx = canvas.getContext('2d');
            if (!ctx) {
                log('错误: 无法获取2D上下文');
                return;
            }
            
            log('Canvas和2D上下文正常');
            
            // 清空并绘制测试内容
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = '#2196f3';
            ctx.font = '20px Arial';
            ctx.fillText('测试文本', 50, 50);
            
            ctx.fillStyle = '#4caf50';
            ctx.font = '16px Arial';
            ctx.fillText('Canvas 渲染正常！', 50, 100);
            
            log('Canvas渲染测试完成');
        }
        
        function testApp() {
            clearLog();
            log('开始应用测试...');
            
            // 检查全局变量
            if (typeof CANVAS_CONFIG === 'undefined') {
                log('错误: CANVAS_CONFIG 未定义');
            } else {
                log('CANVAS_CONFIG 已加载');
            }
            
            if (typeof MathProblem === 'undefined') {
                log('错误: MathProblem 未定义');
            } else {
                log('MathProblem 已加载');
                try {
                    const problem = new MathProblem(5, 3, '+', 8);
                    log('MathProblem 创建成功: ' + problem.toString());
                } catch (error) {
                    log('MathProblem 创建失败: ' + error.message);
                }
            }
            
            if (typeof RenderingEngine === 'undefined') {
                log('错误: RenderingEngine 未定义');
            } else {
                log('RenderingEngine 已加载');
                try {
                    const engine = new RenderingEngine();
                    log('RenderingEngine 创建成功');
                } catch (error) {
                    log('RenderingEngine 创建失败: ' + error.message);
                }
            }
            
            if (typeof MathWorksheetApp === 'undefined') {
                log('错误: MathWorksheetApp 未定义');
            } else {
                log('MathWorksheetApp 已加载');
            }
        }
        
        // 页面加载时自动运行基础测试
        window.addEventListener('load', function() {
            log('页面加载完成');
            testBasic();
        });
    </script>
    
    <!-- 加载应用脚本 -->
    <script src="js/utils/constants.js"></script>
    <script src="js/models/MathProblem.js"></script>
    <script src="js/models/WorksheetConfig.js"></script>
    <script src="js/core/RenderingEngine.js"></script>
    <script src="js/app.js"></script>
</body>
</html>